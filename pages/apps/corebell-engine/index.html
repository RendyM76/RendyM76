<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="referrer" content="strict-origin">
    <link rel="icon" href="/data/images/favicon.png">
    <link rel="stylesheet" href="/data/css/main.css">
    <title>Interface | Corebell Engine</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #scene-container {
            width: 100vw;
            height: 100vh;
        }
        .widget-panel {
            position: absolute;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: move;
            user-select: none;
        }
        #object-library {
            top: 10px;
            right: 10px;
            width: 200px;
        }
        .object-item {
            padding: 8px;
            margin: 4px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            cursor: pointer;
        }
        .object-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        #stats {
            top: 10px;
            left: 10px;
        }
    </style>
</head>
<body>
    <div id="scene-container"></div>
    <div id="object-library" class="widget-panel">
        <h3>Object Library</h3>
        <div class="object-item">Cube</div>
        <div class="object-item">Sphere</div>
        <div class="object-item">Cylinder</div>
        <div class="object-item">Torus</div>
    </div>
    <div id="stats" class="widget-panel">
        <h3>Statistics</h3>
        <div id="fps">FPS: 60</div>
        <div id="objects">Objects: 1</div>
    </div>

    <!-- Core Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>
    
    <script>
        class Engine {
            constructor() {
                this.container = document.getElementById('scene-container');
                this.scene = new THREE.Scene();
                this.objects = [];
                this.createCamera();
                this.createRenderer();
                this.createControls();
                this.createLights();
                this.createGeometry();
                this.setupGUI();
                this.setupDraggableWidgets();
                this.setupObjectLibrary();
                this.addEventListeners();
                this.lastTime = performance.now();
                this.frames = 0;
                this.render();
            }

            createCamera() {
                this.camera = new THREE.PerspectiveCamera(
                    75, 
                    window.innerWidth / window.innerHeight,
                    0.1,
                    1000
                );
                this.camera.position.set(0, 0, 10);
            }

            createRenderer() {
                this.renderer = new THREE.WebGLRenderer({
                    antialias: true,
                });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setPixelRatio(window.devicePixelRatio);
                this.renderer.physicallyCorrectLights = true;
                this.container.appendChild(this.renderer.domElement);
            }

            createControls() {
                this.controls = new THREE.OrbitControls(
                    this.camera,
                    this.renderer.domElement
                );
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
            }

            createLights() {
                this.ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
                this.scene.add(this.ambientLight);

                this.directionalLight = new THREE.DirectionalLight(0xffffff, 1);
                this.directionalLight.position.set(10, 10, 10);
                this.scene.add(this.directionalLight);
            }

            createGeometry() {
                const geometry = new THREE.BoxGeometry(2, 2, 2);
                const material = new THREE.MeshPhongMaterial({
                    color: 0x6699ff,
                    flatShading: true,
                });
                this.cube = new THREE.Mesh(geometry, material);
                this.scene.add(this.cube);
                this.objects.push(this.cube);
            }

            setupGUI() {
                this.gui = new dat.GUI();
                
                // Scene controls
                const sceneFolder = this.gui.addFolder('Scene');
                const sceneControls = {
                    backgroundColor: '#000000',
                };
                sceneFolder.addColor(sceneControls, 'backgroundColor').onChange((value) => {
                    this.scene.background = new THREE.Color(value);
                });
                
                // Light controls
                const lightFolder = this.gui.addFolder('Lights');
                const lightControls = {
                    ambientIntensity: 0.5,
                    directionalIntensity: 1,
                };
                lightFolder.add(lightControls, 'ambientIntensity', 0, 2).onChange((value) => {
                    this.ambientLight.intensity = value;
                });
                lightFolder.add(lightControls, 'directionalIntensity', 0, 2).onChange((value) => {
                    this.directionalLight.intensity = value;
                });

                sceneFolder.open();
                lightFolder.open();
            }

            setupDraggableWidgets() {
                const widgets = document.querySelectorAll('.widget-panel');
                widgets.forEach(widget => {
                    this.makeWidgetDraggable(widget);
                });
            }

            makeWidgetDraggable(element) {
                let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                element.onmousedown = dragMouseDown;

                function dragMouseDown(e) {
                    e.preventDefault();
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    document.onmouseup = closeDragElement;
                    document.onmousemove = elementDrag;
                }

                function elementDrag(e) {
                    e.preventDefault();
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    element.style.top = (element.offsetTop - pos2) + "px";
                    element.style.left = (element.offsetLeft - pos1) + "px";
                }

                function closeDragElement() {
                    document.onmouseup = null;
                    document.onmousemove = null;
                }
            }

            setupObjectLibrary() {
                const objectItems = document.querySelectorAll('.object-item');
                objectItems.forEach(item => {
                    item.addEventListener('click', () => {
                        this.addObject(item.textContent.toLowerCase());
                    });
                });
            }

            addObject(type) {
                let geometry;
                switch(type) {
                    case 'cube':
                        geometry = new THREE.BoxGeometry(2, 2, 2);
                        break;
                    case 'sphere':
                        geometry = new THREE.SphereGeometry(1, 32, 32);
                        break;
                    case 'cylinder':
                        geometry = new THREE.CylinderGeometry(1, 1, 2, 32);
                        break;
                    case 'torus':
                        geometry = new THREE.TorusGeometry(1, 0.4, 16, 100);
                        break;
                }

                const material = new THREE.MeshPhongMaterial({
                    color: Math.random() * 0xffffff,
                    flatShading: true,
                });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(
                    Math.random() * 6 - 3,
                    Math.random() * 6 - 3,
                    Math.random() * 6 - 3
                );
                this.scene.add(mesh);
                this.objects.push(mesh);
                document.getElementById('objects').textContent = `Objects: ${this.objects.length}`;
            }

            addEventListeners() {
                window.addEventListener('resize', this.onWindowResize.bind(this));
            }

            onWindowResize() {
                this.camera.aspect = window.innerWidth / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth, window.innerHeight);
            }

            updateFPS() {
                const now = performance.now();
                const delta = now - this.lastTime;
                this.frames++;
                
                if (delta >= 1000) {
                    const fps = Math.round((this.frames * 1000) / delta);
                    document.getElementById('fps').textContent = `FPS: ${fps}`;
                    this.frames = 0;
                    this.lastTime = now;
                }
            }

            update() {
                this.objects.forEach(obj => {
                    obj.rotation.x += 0.005;
                    obj.rotation.y += 0.005;
                });
                this.controls.update();
                this.updateFPS();
            }

            render() {
                requestAnimationFrame(this.render.bind(this));
                this.update();
                this.renderer.render(this.scene, this.camera);
            }
        }

        // Initialize the engine when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            const engine = new Engine();
        });
    </script>
</body>
</html>
